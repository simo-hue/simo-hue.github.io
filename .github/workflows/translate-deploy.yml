name: Hugo Translation & Deploy

on:
  # Trigger automatico su push al branch principale
  push:
    branches: [ master, main ]
    paths:
      - 'content/english/**'
      - 'scripts/**'
      - '.github/workflows/**'

  # Trigger manuale
  workflow_dispatch:

  # Schedule giornaliero alle 2:00 AM
  schedule:
    - cron: '0 2 * * *'

permissions:
  contents: write
  pages: write
  id-token: write

concurrency:
  group: "pages-${{ github.ref }}"
  cancel-in-progress: false

jobs:
  deploy:
    name: ðŸš€ Deploy to GitHub Pages
    runs-on: ubuntu-24.04
    if: always()

    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}

    steps:
      - name: ðŸ“‹ Checkout repository
        uses: actions/checkout@v4
        with:
          ref: master
          fetch-depth: 0

      - name: ðŸ—ï¸ Setup Hugo
        uses: peaceiris/actions-hugo@v3
        with:
          hugo-version: 'latest'
          extended: true

      - name: ðŸ—‚ï¸ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: ðŸ“¦ Install npm dependencies
        run: npm ci

      - name: ðŸ—ï¸ Build Hugo site
        run: |
          echo "ðŸ—ï¸ Building Hugo site..."
          hugo --minify --environment production
          echo "âœ… Site built successfully"

      - name: ðŸ“„ Setup Pages
        uses: actions/configure-pages@v4

      - name: ðŸ“¤ Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: './public'

      - name: ðŸš€ Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4

  notify:
    name: ðŸ“¬ Notify completion
    runs-on: ubuntu-24.04
    needs: [deploy]
    if: always()

    steps:
      - name: ðŸ“Š Report results
        run: |
          echo "## ðŸŽ‰ Workflow Completed" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Deploy Job:** ${{ needs.deploy.result }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Site URL:** https://simo-hue.github.io" >> $GITHUB_STEP_SUMMARY
          echo "**Timestamp:** $(date +'%Y-%m-%d %H:%M:%S UTC')" >> $GITHUB_STEP_SUMMARY