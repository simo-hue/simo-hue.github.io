{{ if site.Data.timeline.enable }}
<!-- Container: Add padding to avoid edge clipping -->
<div class="relative wrap overflow-hidden p-2 md:p-4 h-full">

    <!-- Vertical Line: Always Centered -->
    <div class="absolute border-opacity-20 border-gray-700 h-full border dark:border-gray-500 left-1/2 transform -translate-x-1/2"
        style="border-style: solid; border-width: 0 0 0 2px;"></div>

    {{ range $index, $item := site.Data.timeline.items }}
    <!-- Timeline Item Row -->
    <!-- Use gap-0 to rely on justify-between and explicit widths -->
    <div
        class="timeline-item opacity-0 translate-y-8 transition-all duration-700 ease-out mb-8 flex justify-between items-center w-full {{ if (modBool $index 2) }}flex-row-reverse{{ else }}flex-row{{ end }}">

        <!-- Spacer (Left or Right) -->
        <div class="order-1 w-5/12"></div>

        <!-- Icon Circle: Absolute Center -->
        <div
            class="z-20 flex items-center justify-center order-1 bg-primary dark:bg-darkmode-primary shadow-xl w-10 h-10 md:w-14 md:h-14 rounded-full absolute left-1/2 transform -translate-x-1/2 border-4 border-white dark:border-darkmode-body">
            <div class="mx-auto text-white dark:text-text-dark font-semibold text-sm md:text-lg">
                <i class="{{ .icon }}"></i>
            </div>
        </div>

        <!-- Content Box -->
        <!-- w-5/12 ensures there is 2/12 (16.6%) space in the middle for the icon -->
        <div class="timeline-card order-1 rounded-lg shadow-md w-5/12 px-3 py-3 md:px-6 md:py-6 bg-white dark:bg-darkmode-light border border-border dark:border-darkmode-border transition-all hover:scale-[1.02] hover:shadow-xl z-10 block cursor-pointer"
            data-date="{{ .date }}" data-title="{{ .title }}" data-organization="{{ .organization }}"
            data-description="{{ .description }}" data-icon="{{ .icon }}" data-tags="{{ delimit .tags " |" }}" {{ with
            .extended_description }}data-extended-description="{{ . }}" {{ end }} {{ with .achievements
            }}data-achievements="{{ delimit . " |" }}"{{ end }} {{ with .links }}data-links='{{ jsonify . }}' {{ end }}>

            <!-- Header: Date and Title -->
            <div class="flex flex-col mb-1 md:mb-2">
                <span
                    class="text-primary dark:text-darkmode-primary font-bold text-[10px] md:text-xs uppercase tracking-wider mb-1">{{
                    .date }}</span>
                <h3 class="font-bold text-gray-800 dark:text-white text-xs md:text-xl leading-tight mb-0.5">{{
                    .title }}</h3>
                <h4 class="font-semibold text-gray-500 dark:text-gray-400 text-[10px] md:text-sm">{{
                    .organization }}</h4>
            </div>

            <!-- Description -->
            <p
                class="text-[10px] md:text-sm leading-normal text-gray-700 dark:text-gray-200 mb-2 md:mb-4 line-clamp-4 md:line-clamp-none">
                {{ .description }}
            </p>

            <!-- Tags -->
            <div class="flex flex-wrap gap-1 md:gap-2">
                {{ range .tags }}
                <span
                    class="text-[9px] md:text-xs font-medium px-1.5 py-0.5 rounded bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 whitespace-nowrap">
                    {{ . }}
                </span>
                {{ end }}
            </div>
        </div>
    </div>
    {{ end }}
</div>

<!-- Timeline Modal -->
<div id="timelineModal"
    class="fixed inset-0 z-50 hidden items-center justify-center p-4 bg-black/50 backdrop-blur-lg transition-all duration-300 opacity-0">
    <div
        class="timeline-modal-content relative bg-white dark:bg-darkmode-body rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto transform scale-95 transition-all duration-300">
        <!-- Close Button -->
        <button id="closeModal"
            class="absolute top-4 right-4 z-10 w-10 h-10 flex items-center justify-center rounded-full bg-gray-100 dark:bg-darkmode-light hover:bg-gray-200 dark:hover:bg-darkmode-border transition-colors">
            <svg class="w-6 h-6 text-gray-600 dark:text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
        </button>

        <!-- Modal Content -->
        <div class="p-6 md:p-8">
            <!-- Icon Circle -->
            <div class="flex items-center justify-center mb-6">
                <div
                    class="flex items-center justify-center bg-primary dark:bg-darkmode-primary shadow-xl w-16 h-16 md:w-20 md:h-20 rounded-full">
                    <i id="modalIcon" class="text-white dark:text-text-dark text-2xl md:text-3xl"></i>
                </div>
            </div>

            <!-- Header: Date and Title -->
            <div class="text-center mb-6">
                <span id="modalDate"
                    class="text-primary dark:text-darkmode-primary font-bold text-sm md:text-base uppercase tracking-wider mb-2 block"></span>
                <h2 id="modalTitle"
                    class="font-bold text-gray-800 dark:text-white text-2xl md:text-3xl leading-tight mb-2"></h2>
                <h3 id="modalOrganization" class="font-semibold text-gray-500 dark:text-gray-400 text-base md:text-lg">
                </h3>
            </div>

            <!-- Description -->
            <p id="modalDescription"
                class="text-base md:text-lg leading-relaxed text-gray-700 dark:text-gray-200 mb-6 whitespace-pre-line">
            </p>

            <!-- Achievements Section (hidden by default) -->
            <div id="modalAchievementsSection" class="hidden mb-6">
                <h4 class="flex items-center gap-2 text-lg font-bold text-gray-800 dark:text-white mb-3">
                    <i class="fa-solid fa-trophy text-yellow-500"></i>
                    Key Achievements
                </h4>
                <ul id="modalAchievements" class="space-y-2"></ul>
            </div>

            <!-- Links Section (hidden by default) -->
            <div id="modalLinksSection" class="hidden mb-6">
                <h4 class="flex items-center gap-2 text-lg font-bold text-gray-800 dark:text-white mb-3">
                    <i class="fa-solid fa-link text-blue-500"></i>
                    Related Links
                </h4>
                <div id="modalLinks" class="flex flex-wrap gap-2"></div>
            </div>

            <!-- Tags -->
            <div id="modalTags" class="flex flex-wrap gap-2 justify-center"></div>
        </div>
    </div>
</div>
{{ end }}