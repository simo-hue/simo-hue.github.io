<!-- DNS preconnect for critical origins -->
<link rel="preconnect" href="https://www.googletagmanager.com" crossorigin />
<link rel="dns-prefetch" href="https://www.googletagmanager.com" />
<link rel="preconnect" href="https://use.fontawesome.com" crossorigin />
<link rel="dns-prefetch" href="https://use.fontawesome.com" />

<!-- Critical Font CSS inline to prevent blocking -->
<style>
    @font-face {
        font-family: 'Heebo';
        src: url('/fonts/Heebo-Regular.ttf') format('truetype');
        font-weight: 400;
        font-style: normal;
        font-display: swap;
    }

    @font-face {
        font-family: 'Signika';
        src: url('/fonts/Signika-Medium.ttf') format('truetype');
        font-weight: 500;
        font-style: normal;
        font-display: swap;
    }
</style>

<!-- main styles -->
{{ $styles := slice }}
{{ $stylesLazy := slice }}

<!-- Local Fonts -->
{{ $styles = $styles | append (resources.Get "css/fonts.css") }}

{{ range site.Params.plugins.css }}
{{ if findRE "^http" .link }}
<link crossorigin="anonymous" media="all" rel="stylesheet" href="{{ .link | relURL }}" {{ .attributes | safeHTMLAttr
    }} />
{{ else }}
{{ if not .lazy }}
{{ $styles = $styles | append (resources.Get .link) }}
{{ else }}
{{ $stylesLazy = $stylesLazy | append (resources.Get .link) }}
{{ end }}
{{ end }}
{{ end }}

{{ $mainCSS := resources.Get "css/main.css" }}
{{ $tailwindOpts := dict "inlineImports" true }}
{{ $tailwindCSS := $mainCSS | css.TailwindCSS $tailwindOpts }}

{{ $styles = $styles | append $tailwindCSS }}
{{ $styles = $styles | resources.Concat "css/style.css" }}

{{ $stylesLazy = $stylesLazy | resources.Concat "css/style-lazy.css" }}

{{ if hugo.IsProduction }}
{{ $styles = $styles | fingerprint }}
{{ $stylesLazy = $stylesLazy | minify | fingerprint }}
{{ end }}


<!-- link main style -->
<link href="{{ $styles.RelPermalink }}" integrity="{{ $styles.Data.Integrity }}" rel="stylesheet" />

<!-- link lazy style with media print trick for non-blocking load -->
<link rel="stylesheet" href="{{ $stylesLazy.RelPermalink }}" integrity="{{ $stylesLazy.Data.Integrity }}" media="print"
    onload="this.media='all'; this.onload=null;" />